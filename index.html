<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flow for Good</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: linear-gradient(to bottom, #e0f7fa, #00b0ff);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #00b0ff;
      color: white;
    }
    .instruction-text {
      text-align: center;
      font-weight: bold;
      margin: 10px 0;
      color: #333;
    }
    .game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 auto;
    }
    .icon-row {
      display: flex;
      justify-content: center;
      width: 100%;
    }
    .pipe-icon, .bucket-icon {
      font-size: 24px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 30px);
      grid-template-rows: repeat(10, 30px);
      gap: 2px;
      justify-content: center;
      margin: 10px 0;
      background: #b3e5fc;
      padding: 5px;
      border-radius: 5px;
    }
    .tile {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: white;
    }
    .dirt { background: #8d6e63; cursor: pointer; }
    .rock { background: #9e9e9e; }
    .dirty { background: #c97272; }
    .bonus { background: #ffd700; }
    .pipe { background: #00b0ff; }
    .bucket { background: #00b0ff; }
    .overlay, .feedback {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
    }
    .button {
      margin: 5px;
      padding: 10px 20px;
      background: #00b0ff;
      border: none;
      color: white;
      cursor: pointer;
    }
    .footer {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      color: #555;
      position: relative;
    }
    .footer:after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background: linear-gradient(to right, transparent, #00b0ff, transparent);
      bottom: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <!-- Header Bar -->
  <div class="header">
    <div>POINTS: <span id="points">0</span> ‚≠ê x<span id="bonus">0</span></div>
    <div>Flow for Good</div>
    <div>
      RESET <button id="resetBtn" title="Reset"><img src="img/reset.png" alt="Reset" style="height:18px;vertical-align:middle;"></button>
    </div>
  </div>

  <!-- Instruction Text -->
  <div class="instruction-text">
    <b>Create a path for the water to get to the bucket!</b>
  </div>

  <!-- Game Area with faucet, grid, and bucket -->
  <div class="game-area">
    <div class="icon-row">
      <span class="pipe-icon">‚õèÔ∏è</span>
    </div>
    <div class="grid" id="grid"></div>
    <div class="icon-row">
      <span class="bucket-icon">ü™£</span>
    </div>
  </div>

  <!-- Start Flow Button -->
  <button class="button" id="startFlowBtn">Start Flow</button>

  <!-- Overlays -->
  <div class="overlay" id="instruction">
    <p>
      Click or drag across the tiles to dig a path from the tool to the bucket.<br>
      - Avoid pollution tiles!<br>
      - Collect bonus droplets for extra points.<br>
      - Use the reset button to clear your path.<br>
      - Click "Start Flow" to check your path.
    </p>
    <button class="button" id="hideInstructionBtn">Got it!</button>
  </div>
  <div class="feedback" id="success">
    <h2>‚úÖ Success!</h2>
    <p>You delivered clean water!</p>
    <p>+<span id="successPoints">10</span> points</p>
    <p>Every minute, someone begins walking for water.</p>
    <button class="button" id="nextLevelBtn">Next Level</button>
    <button class="button" id="playAgainBtn">Play Again</button>
  </div>
  <div class="feedback" id="failure">
    <h2>‚ùå Oops!</h2>
    <p>Water got polluted.</p>
    <p>1 in 10 people lack clean water.</p>
    <button class="button" id="tryAgainBtn">Try Again</button>
  </div>

  <!-- Footer -->
  <div class="footer" style="position:fixed; left:0; right:0; bottom:0;">
    FLOW FOR GOOD
    <span style="margin: 0 8px;">ü§ù</span>
    charity: water
    <img src="img/cw.png" alt="charity: water logo" style="height:22px; margin-left:8px; vertical-align:middle;">
  </div>
  <script>
    const gridEl = document.getElementById('grid');
    const pointsEl = document.getElementById('points');
    const bonusEl = document.getElementById('bonus');
    let points = 0;
    let bonus = 0;

    // For drag-to-dig
    let isDragging = false;

    function buildGrid() {
      gridEl.innerHTML = '';
      // Store tile elements for drag logic
      const tiles = [];
      for (let i = 0; i < 100; i++) {
        const tile = document.createElement('div');
        // Default to dirt
        tile.className = 'tile dirt';
        // Randomly assign type and icon
        if (Math.random() < 0.1) {
          tile.className = 'tile rock';
          tile.textContent = 'ü™®'; // Rock icon
        } else if (Math.random() < 0.05) {
          tile.className = 'tile dirty';
          tile.textContent = '‚ö†Ô∏è'; // Pollution icon (plastic bottle)
        } else if (Math.random() < 0.05) {
          tile.className = 'tile bonus';
          tile.textContent = 'üíß'; // Bonus droplet
        }
        // Mouse events for drag-to-dig
        tile.addEventListener('mousedown', (e) => {
          if (tile.classList.contains('dirt') || tile.classList.contains('bonus')) {
            isDragging = true;
            digTile(tile);
          }
        });
        tile.addEventListener('mouseover', (e) => {
          if (isDragging && (tile.classList.contains('dirt') || tile.classList.contains('bonus'))) {
            digTile(tile);
          }
        });
        // Touch events for mobile
        tile.addEventListener('touchstart', (e) => {
          if (tile.classList.contains('dirt') || tile.classList.contains('bonus')) {
            isDragging = true;
            digTile(tile);
            e.preventDefault();
          }
        });
        tile.addEventListener('touchmove', (e) => {
          const touch = e.touches[0];
          const target = document.elementFromPoint(touch.clientX, touch.clientY);
          if (isDragging && target && (target.classList.contains('dirt') || target.classList.contains('bonus'))) {
            digTile(target);
          }
        });
        tiles.push(tile);
        gridEl.appendChild(tile);
      }
      // Stop dragging when mouse/touch ends
      document.addEventListener('mouseup', () => { isDragging = false; });
      document.addEventListener('touchend', () => { isDragging = false; });
    }

    // Helper to dig a tile
    function digTile(tile) {
      if (tile.classList.contains('dirt')) {
        tile.style.background = '#b3e5fc';
        tile.classList.remove('dirt');
        tile.textContent = '';
      }
      if (tile.classList.contains('bonus')) {
        tile.style.background = '#b3e5fc';
        tile.classList.remove('bonus');
        tile.textContent = '';
        bonus++;
        bonusEl.textContent = bonus;
      }
    }

    function resetGame() {
      points = 0;
      bonus = 0;
      pointsEl.textContent = points;
      bonusEl.textContent = bonus;
      document.getElementById('success').style.display = 'none';
      document.getElementById('failure').style.display = 'none';
      buildGrid();
    }

    function startFlow() {
      if (Math.random() > 0.5) {
        document.getElementById('success').style.display = 'flex';
        points += 10 + bonus;
        pointsEl.textContent = points;
        document.getElementById('successPoints').textContent = 10 + bonus;
      } else {
        document.getElementById('failure').style.display = 'flex';
      }
    }

    function hideInstruction() {
      document.getElementById('instruction').style.display = 'none';
    }

    document.getElementById('instruction').style.display = 'flex';
    buildGrid();
    document.getElementById('hideInstructionBtn').onclick = hideInstruction;
    document.getElementById('resetBtn').onclick = resetGame;
    document.getElementById('startFlowBtn').onclick = startFlow;
    document.getElementById('nextLevelBtn').onclick = resetGame;
    document.getElementById('playAgainBtn').onclick = resetGame;
    document.getElementById('tryAgainBtn').onclick = resetGame;
  </script>
</body>
</html>
